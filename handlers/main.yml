---
# handlers file for ansible-role-logstash

- name: Restart logstash
  # notify this handler only when full restart is required
  service:
    name: "{{ logstash_service_name }}"
    state: restarted
    enabled: yes
  notify: Wait for logstash to start

- name: Wait for logstash to start
  wait_for:
    host: "{{ logstash_api_host }}"
    port: "{{ logstash_api_port }}"
  when: logstash_api_enabled


- name: Reload logstash
  # notify this handler when configuration files has been changed.
  #
  # XXX cannot use /var/run/logstash.pid here. startup script auto-generated by
  # the official package does not create PID file.
  shell: 'kill -HUP `jps -ml | grep -E "org\.jruby\.Main\s.*logstash\/runner\.rb " | cut -f1 -d" "`'
